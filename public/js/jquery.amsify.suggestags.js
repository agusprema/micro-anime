!function(s){s.fn.amsifySuggestags=function(t,e){var i=s.extend({type:"bootstrap",tagLimit:-1,suggestions:[],suggestionsAction:{},classes:[],backgrounds:[],colors:[],whiteList:!1,afterAdd:{},afterRemove:{}},t),a=function(){this.selector=null,this.name=null,this.defaultLabel="Type here",this.classes={sTagsArea:".amsify-suggestags-area",inputArea:".amsify-suggestags-input-area",inputAreaDef:".amsify-suggestags-input-area-default",focus:".amsify-focus",sTagsInput:".amsify-suggestags-input",listArea:".amsify-suggestags-list",list:".amsify-list",listItem:".amsify-list-item",itemPad:".amsify-item-pad",inputType:".amsify-select-input",tagItem:".amsify-select-tag",colBg:".col-bg",removeTag:".amsify-remove-tag",readyToRemove:".ready-to-remove"},this.selectors={sTagsArea:null,inputArea:null,inputAreaDef:null,sTagsInput:null,listArea:null,list:null,listGroup:null,listItem:null,itemPad:null,inputType:null},this.ajaxActive=!1,this.tagNames=[]};return a.prototype={_init:function(t){this.refresh(t,e)&&(this.selector=t,this.name=s(t).attr("name")?s(t).attr("name")+"_amsify":"amsify_suggestags",this.createHTML(),this.setEvents(),s(this.selector).hide(),this.setDefault())},createHTML:function(){var t='<div class="'+this.classes.sTagsArea.substring(1)+'"></div>';this.selectors.sTagsArea=s(t).insertAfter(this.selector);var e='<div class="'+this.classes.inputArea.substring(1)+'"></div>';this.selectors.inputArea=s(e).appendTo(this.selectors.sTagsArea),this.defaultLabel=void 0!==s(this.selector).attr("placeholder")?s(this.selector).attr("placeholder"):this.defaultLabel;var i='<input type="text" class="'+this.classes.sTagsInput.substring(1)+'" placeholder="'+this.defaultLabel+'">';this.selectors.sTagsInput=s(i).appendTo(this.selectors.inputArea).attr("autocomplete","off");var a='<div class="'+this.classes.listArea.substring(1)+'"></div>';this.selectors.listArea=s(a).appendTo(this.selectors.sTagsArea),s(this.selectors.listArea).width(s(this.selectors.sTagsArea).width()-3);var n='<ul class="'+this.classes.list.substring(1)+'"></ul>';this.selectors.list=s(n).appendTo(this.selectors.listArea),this.updateSuggestionList(),this.fixCSS()},updateSuggestionList:function(){s(this.selectors.list).html(""),s(this.createList()).appendTo(this.selectors.list)},setEvents:function(){var t=this;s(this.selectors.inputArea).attr("style",s(this.selector).attr("style")).addClass(s(this.selector).attr("class")),this.setTagEvents(),s(window).resize(function(){s(t.selectors.listArea).width(s(t.selectors.sTagsArea).width()-3)}),this.setSuggestionsEvents(),this.setRemoveEvent()},setTagEvents:function(){var t=this;s(this.selectors.sTagsInput).focus(function(){s(this).closest(t.classes.inputArea).addClass(t.classes.focus.substring(1)),"materialize"==i.type&&s(this).css({"border-bottom":"none","-webkit-box-shadow":"none","box-shadow":"none"})}),s(this.selectors.sTagsInput).blur(function(){s(this).closest(t.classes.inputArea).removeClass(t.classes.focus.substring(1))}),s(this.selectors.sTagsInput).keyup(function(e){var a=e.keyCode?e.keyCode:e.which;if("13"==a||"188"==a){var n=s.trim(s(this).val().replace(/,/g,""));s(this).val(""),t.addTag(n)}else if("8"!=a||s(this).val())(i.suggestions.length||t.isSuggestAction())&&s(this).val()&&(s(this).removeClass(t.classes.readyToRemove.substring(1)),t.processWhiteList(a,s(this).val()));else{var o=t.classes.readyToRemove.substring(1);s(this).hasClass(o)?($item=s(this).closest(t.classes.inputArea).find(t.classes.tagItem+":last"),t.removeTag($item,!1)):s(this).addClass(o),s(t.selectors.listArea).hide()}}),s(this.selectors.sTagsArea).click(function(){s(t.selectors.sTagsInput).focus()})},setSuggestionsEvents:function(){var t=this;s(this.selectors.listArea).find(this.classes.listItem).hover(function(){s(t.selectors.listArea).find(t.classes.listItem).removeClass("active"),s(this).addClass("active"),s(t.selectors.sTagsInput).val(s(this).data("val"))},function(){s(this).removeClass("active")}),s(this.selectors.listArea).find(this.classes.listItem).click(function(){t.addTag(s(this).data("val")),s(t.selectors.sTagsInput).val("").focus()})},isSuggestAction:function(){return i.suggestionsAction&&i.suggestionsAction.url},processAjaxSuggestion:function(t,e){var a=this,n=this.getActionURL(i.suggestionsAction.url),o={existing:i.suggestions,term:t},r=(i.suggestionsAction.callbacks&&i.suggestionsAction.callbacks,{type:"POST",url:n,data:JSON.stringify(o),dataType:"json"});void 0!==i.suggestionsAction.beforeSend&&"function"==typeof i.suggestionsAction.beforeSend&&(r.beforeSend=i.suggestionsAction.beforeSend),r.success=function(n){n&&n.suggestions&&(i.suggestions=s.extend(i.suggestions,n.suggestions),i.suggestions=a.unique(i.suggestions),a.updateSuggestionList(),a.setSuggestionsEvents(),a.suggestWhiteList(t,e)),void 0!==i.suggestionsAction.success&&"function"==typeof i.suggestionsAction.success&&i.suggestionsAction.success(n)},void 0!==i.suggestionsAction.error&&"function"==typeof i.suggestionsAction.error&&(r.error=i.suggestionsAction.error),r.complete=function(s){void 0!==i.suggestionsAction.complete&&"function"==typeof i.suggestionsAction.complete&&i.suggestionsAction.complete(s),a.ajaxActive=!1},s.ajax(r)},processWhiteList:function(s,t){if("40"==s||"38"==s){var e="40"==s?"down":"up";this.upDownSuggestion(t,e)}else this.isSuggestAction()&&!this.ajaxActive?(this.ajaxActive=!0,this.processAjaxSuggestion(t,s)):this.suggestWhiteList(t,s)},upDownSuggestion:function(t,e){var i=this,a=!1;if(s(this.selectors.listArea).find(this.classes.listItem+":visible").each(function(){if(s(this).hasClass("active"))return s(this).removeClass("active"),$item="up"==e?s(this).prevAll(i.classes.listItem+":visible:first"):s(this).nextAll(i.classes.listItem+":visible:first"),$item.length&&(a=!0,$item.addClass("active"),s(i.selectors.sTagsInput).val($item.data("val"))),!1}),!a){var n="down"==e?"first":"last";$item=s(this.selectors.listArea).find(this.classes.listItem+":visible:"+n),$item.length&&($item.addClass("active"),s(i.selectors.sTagsInput).val($item.data("val")))}},suggestWhiteList:function(t,e){var a=this,n=!1;s(this.selectors.listArea).find(this.classes.listItem).each(function(){~s(this).attr("data-val").toLowerCase().indexOf(t.toLowerCase())&&-1===s.inArray(s(this).attr("data-val"),a.tagNames)?(s(this).show(),n=!0):s(this).hide()}),n?(s(this.selectors.listArea).show(),$item=s(this.selectors.listArea).find(this.classes.listItem+":visible"),1==$item.length&&"8"!=e?(i.whiteList&&this.isSimilarText(t.toLowerCase(),$item.data("val").toLowerCase(),40)||this.isSimilarText(t.toLowerCase(),$item.data("val").toLowerCase(),60))&&($item.addClass("active"),s(this.selectors.sTagsInput).val($item.data("val"))):$item.removeClass("active")):s(this.selectors.listArea).hide()},setDefault:function(){var t=this,e=s(this.selector).val().split(",");e.length&&s.each(e,function(e,i){t.addTag(s.trim(i))})},setRemoveEvent:function(){var t=this;s(this.selectors.inputArea).find(this.classes.removeTag).click(function(e){e.stopImmediatePropagation(),$tagItem=s(this).closest(t.classes.tagItem),t.removeTag($tagItem,!1)})},createList:function(){var t=this,e="";return s.each(i.suggestions,function(s,i){e+='<li class="'+t.classes.listItem.substring(1)+'" data-val="'+i+'">'+i+"</li>"}),e},addTag:function(t){if(t){var e='<span class="'+this.classes.tagItem.substring(1)+'" data-val="'+t+'">'+t+" "+this.setIcon()+"</span>";if($item=s(e).insertBefore(s(this.selectors.sTagsInput)),-1!=i.tagLimit&&i.tagLimit>0&&this.tagNames.length>=i.tagLimit)return this.animateRemove($item,!0),this.flashItem(t),!1;var a=s.inArray(t,i.suggestions);if(i.whiteList&&-1===a)return this.animateRemove($item,!0),this.flashItem(t),!1;this.isPresent(t)?(this.animateRemove($item,!0),this.flashItem(t)):(this.customStylings($item,a),this.tagNames.push(t),this.setRemoveEvent(),this.setInputValue(),i.afterAdd&&"function"==typeof i.afterAdd&&i.afterAdd(t)),s(this.selector).trigger("suggestags.add",[t]),s(this.selectors.listArea).find(this.classes.listItem).removeClass("active"),s(this.selectors.listArea).hide(),s(this.selectors.sTagsInput).removeClass(this.classes.readyToRemove.substring(1))}},isPresent:function(t){var e=!1;return s.each(this.tagNames,function(s,i){if(t.toLowerCase()==i.toLowerCase())return e=!0,!1}),e},customStylings:function(t,e){var a=!1;i.classes[e]&&(a=!0,s(t).addClass(i.classes[e])),i.backgrounds[e]&&(a=!0,s(t).css("background",i.backgrounds[e])),i.colors[e]&&(a=!0,s(t).css("color",i.colors[e])),a||s(t).addClass(this.classes.colBg.substring(1))},removeTag:function(t,e){this.tagNames.splice(s(t).index(),1),this.animateRemove(t,e),this.setInputValue(),s(this.selector).trigger("suggestags.remove",[s(t).attr("data-val")]),i.afterRemove&&"function"==typeof i.afterRemove&&i.afterRemove(s(t).attr("data-val")),s(this.selectors.sTagsInput).removeClass(this.classes.readyToRemove.substring(1))},animateRemove:function(t,e){s(t).addClass("disabled"),e?setTimeout(function(){s(t).slideUp(),setTimeout(function(){s(t).remove()},500)},500):s(t).remove()},flashItem:function(t){$item="",s(this.selectors.sTagsArea).find(this.classes.tagItem).each(function(){var e=s.trim(s(this).attr("data-val"));if(t.toLowerCase()==e.toLowerCase())return $item=s(this),!1}),$item&&($item.addClass("flash"),setTimeout(function(){$item.removeClass("flash")},1500))},setIcon:function(){var s=this.classes.removeTag.substring(1);return"bootstrap"==i.type?'<span class="fa fa-times '+s+'"></span>':"materialize"==i.type?'<i class="material-icons right '+s+'">clear</i>':'<b class="'+s+'">&#10006;</b>'},setInputValue:function(){s(this.selector).val(this.tagNames.join(",")),this.printValues()},fixCSS:function(){"amsify"==i.type?s(this.selectors.inputArea).addClass(this.classes.inputAreaDef.substring(1)).css({padding:"5px 5px"}):"materialize"==i.type&&(s(this.selectors.inputArea).addClass(this.classes.inputAreaDef.substring(1)).css({height:"auto",padding:"5px 5px"}),s(this.selectors.sTagsInput).css({margin:"0",height:"auto"}))},printValues:function(){console.info(this.tagNames,s(this.selector).val())},refresh:function(t,e){return $findTags=s(t).next(this.classes.sTagsArea),$findTags.length&&$findTags.remove(),s(t).show(),void 0===typeof e||"destroy"!=e},getActionURL:function(s){var t=window.location.protocol+"//"+window.location.host;return this.isAbsoluteURL(s)?t=s:t+="/"+s.replace(/^\/|\/$/g,""),t},isAbsoluteURL:function(s){return!!new RegExp("^(?:[a-z]+:)?//","i").test(s)},unique:function(t){var e=[];return s.each(t,function(t,i){-1==s.inArray(i,e)&&e.push(i)}),e},isSimilarText:function(s,t,e){return 100*this.similarity(s,t)>=e},similarity:function(s,t){var e=s,i=t;s.length<t.length&&(e=t,i=s);var a=e.length;return 0==a?1:(a-this.editDistance(e,i))/parseFloat(a)},editDistance:function(s,t){s=s.toLowerCase(),t=t.toLowerCase();for(var e=new Array,i=0;i<=s.length;i++){for(var a=i,n=0;n<=t.length;n++)if(0==i)e[n]=n;else if(n>0){var o=e[n-1];s.charAt(i-1)!=t.charAt(n-1)&&(o=Math.min(Math.min(o,a),e[n])+1),e[n-1]=a,a=o}i>0&&(e[t.length]=a)}return e[t.length]}},this.each(function(){(new a)._init(this)})}}(jQuery);